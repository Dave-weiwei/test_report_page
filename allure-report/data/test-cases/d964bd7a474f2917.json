{"uid":"d964bd7a474f2917","name":"test_drm_recovery_retry_logic","fullName":"tests.app_manager.test_REF_18990#test_drm_recovery_retry_logic","historyId":"0c754e5fdadc9bc699d15203b31b07dc","time":{"start":1767079341639,"stop":1767079342196,"duration":557},"status":"failed","statusMessage":"AssertionError: Failed to delete drm.jar\nassert 'drm.jar' not in 'com.fca.ada_221026A_MELCO_DEV.apk\\ncom.fca.uconnect.aota_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.assist_230609A_MELCO_DEV.apk\\ncom.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\\ncom.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\\ncom.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\\ncom.fca.uconnect.iva_210217A_MELCO_DEV.apk\\ncom.fca.uconnect.ivm_230323F_MELCO_DEV.apk\\ncom.fca.uconnect.sos_221109A_MELCO_DEV.apk\\ncom.fca.uconnect.tc_230711A_MELCO_DEV.apk\\ncom.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\\ncom.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\\ndrm.jar\\nkim.files'\n  \n  'drm.jar' is contained here:\n    com.fca.ada_221026A_MELCO_DEV.apk\n    com.fca.uconnect.aota_220815B_MELCO_DEV.apk\n    com.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\n    com.fca.uconnect.assist_230609A_MELCO_DEV.apk\n    com.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\n    com.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\n    com.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\n    com.fca.uconnect.iva_210217A_MELCO_DEV.apk\n    com.fca.uconnect.ivm_230323F_MELCO_DEV.apk\n    com.fca.uconnect.sos_221109A_MELCO_DEV.apk\n    com.fca.uconnect.tc_230711A_MELCO_DEV.apk\n    com.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\n    com.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\n    drm.jar\n    kim.files","statusTrace":"adb = <module.adb_tool.ADBTool object at 0x0000021C106B6510>, maintain_drm_integrity = None\n\n    @allure.feature(\"DRM Recovery\")\n    @allure.story(\"Verify AppManager reads local backup files 3 times\")\n    def test_drm_recovery_retry_logic(adb, maintain_drm_integrity):\n    \n        # --- Step 01 ---\n        with allure.step(\"Step 01: Remove drm.properties, backup files AND OLD LOGS\"):\n            adb.shell(f\"rm -rf {DATA_PATH}/*\")\n    \n            # [新增] 務必刪除舊 Log，不然 Regex 會算出 6 次、9 次...\n            adb.shell(f\"rm {LOG_PATH}\")\n    \n            files = adb.shell(f\"ls {DATA_PATH}\")\n            assert \"drm.properties\" not in files, \"Failed to delete drm.properties\"\n    \n        # --- Step 02 (由 Fixture 處理) ---\n        # Fixture 已經執行了 adb.remount()，所以此時 /vendor 是可寫入的\n    \n        # --- Step 03 ---\n        with allure.step(\"Step 03: Remove drm.jar from /vendor/app_package\"):\n            # 直接執行刪除 (記得加 su 0 -f)\n            adb.shell(f\"su 0 rm -f {VENDOR_PATH}/{JAR_NAME}\")\n    \n            vendor_files = adb.shell(f\"ls {VENDOR_PATH}\")\n>           assert JAR_NAME not in vendor_files, \"Failed to delete drm.jar\"\nE           AssertionError: Failed to delete drm.jar\nE           assert 'drm.jar' not in 'com.fca.ada_221026A_MELCO_DEV.apk\\ncom.fca.uconnect.aota_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.assist_230609A_MELCO_DEV.apk\\ncom.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\\ncom.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\\ncom.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\\ncom.fca.uconnect.iva_210217A_MELCO_DEV.apk\\ncom.fca.uconnect.ivm_230323F_MELCO_DEV.apk\\ncom.fca.uconnect.sos_221109A_MELCO_DEV.apk\\ncom.fca.uconnect.tc_230711A_MELCO_DEV.apk\\ncom.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\\ncom.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\\ndrm.jar\\nkim.files'\nE             \nE             'drm.jar' is contained here:\nE               com.fca.ada_221026A_MELCO_DEV.apk\nE               com.fca.uconnect.aota_220815B_MELCO_DEV.apk\nE               com.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\nE               com.fca.uconnect.assist_230609A_MELCO_DEV.apk\nE               com.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\nE               com.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\nE               com.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\nE               com.fca.uconnect.iva_210217A_MELCO_DEV.apk\nE               com.fca.uconnect.ivm_230323F_MELCO_DEV.apk\nE               com.fca.uconnect.sos_221109A_MELCO_DEV.apk\nE               com.fca.uconnect.tc_230711A_MELCO_DEV.apk\nE               com.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\nE               com.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\nE               drm.jar\nE               kim.files\n\ntests\\app_manager\\test_REF_18990.py:85: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"adb","time":{"start":1767079331837,"stop":1767079332033,"duration":196},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"maintain_drm_integrity","time":{"start":1767079341080,"stop":1767079341639,"duration":559},"status":"passed","steps":[{"name":"Step 02: Backup drm.jar to local PC","time":{"start":1767079341080,"stop":1767079341639,"duration":559},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":1,"hasContent":true,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: Failed to delete drm.jar\nassert 'drm.jar' not in 'com.fca.ada_221026A_MELCO_DEV.apk\\ncom.fca.uconnect.aota_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.assist_230609A_MELCO_DEV.apk\\ncom.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\\ncom.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\\ncom.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\\ncom.fca.uconnect.iva_210217A_MELCO_DEV.apk\\ncom.fca.uconnect.ivm_230323F_MELCO_DEV.apk\\ncom.fca.uconnect.sos_221109A_MELCO_DEV.apk\\ncom.fca.uconnect.tc_230711A_MELCO_DEV.apk\\ncom.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\\ncom.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\\ndrm.jar\\nkim.files'\n  \n  'drm.jar' is contained here:\n    com.fca.ada_221026A_MELCO_DEV.apk\n    com.fca.uconnect.aota_220815B_MELCO_DEV.apk\n    com.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\n    com.fca.uconnect.assist_230609A_MELCO_DEV.apk\n    com.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\n    com.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\n    com.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\n    com.fca.uconnect.iva_210217A_MELCO_DEV.apk\n    com.fca.uconnect.ivm_230323F_MELCO_DEV.apk\n    com.fca.uconnect.sos_221109A_MELCO_DEV.apk\n    com.fca.uconnect.tc_230711A_MELCO_DEV.apk\n    com.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\n    com.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\n    drm.jar\n    kim.files","statusTrace":"adb = <module.adb_tool.ADBTool object at 0x0000021C106B6510>, maintain_drm_integrity = None\n\n    @allure.feature(\"DRM Recovery\")\n    @allure.story(\"Verify AppManager reads local backup files 3 times\")\n    def test_drm_recovery_retry_logic(adb, maintain_drm_integrity):\n    \n        # --- Step 01 ---\n        with allure.step(\"Step 01: Remove drm.properties, backup files AND OLD LOGS\"):\n            adb.shell(f\"rm -rf {DATA_PATH}/*\")\n    \n            # [新增] 務必刪除舊 Log，不然 Regex 會算出 6 次、9 次...\n            adb.shell(f\"rm {LOG_PATH}\")\n    \n            files = adb.shell(f\"ls {DATA_PATH}\")\n            assert \"drm.properties\" not in files, \"Failed to delete drm.properties\"\n    \n        # --- Step 02 (由 Fixture 處理) ---\n        # Fixture 已經執行了 adb.remount()，所以此時 /vendor 是可寫入的\n    \n        # --- Step 03 ---\n        with allure.step(\"Step 03: Remove drm.jar from /vendor/app_package\"):\n            # 直接執行刪除 (記得加 su 0 -f)\n            adb.shell(f\"su 0 rm -f {VENDOR_PATH}/{JAR_NAME}\")\n    \n            vendor_files = adb.shell(f\"ls {VENDOR_PATH}\")\n>           assert JAR_NAME not in vendor_files, \"Failed to delete drm.jar\"\nE           AssertionError: Failed to delete drm.jar\nE           assert 'drm.jar' not in 'com.fca.ada_221026A_MELCO_DEV.apk\\ncom.fca.uconnect.aota_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.assist_230609A_MELCO_DEV.apk\\ncom.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\\ncom.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\\ncom.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\\ncom.fca.uconnect.iva_210217A_MELCO_DEV.apk\\ncom.fca.uconnect.ivm_230323F_MELCO_DEV.apk\\ncom.fca.uconnect.sos_221109A_MELCO_DEV.apk\\ncom.fca.uconnect.tc_230711A_MELCO_DEV.apk\\ncom.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\\ncom.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\\ndrm.jar\\nkim.files'\nE             \nE             'drm.jar' is contained here:\nE               com.fca.ada_221026A_MELCO_DEV.apk\nE               com.fca.uconnect.aota_220815B_MELCO_DEV.apk\nE               com.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\nE               com.fca.uconnect.assist_230609A_MELCO_DEV.apk\nE               com.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\nE               com.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\nE               com.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\nE               com.fca.uconnect.iva_210217A_MELCO_DEV.apk\nE               com.fca.uconnect.ivm_230323F_MELCO_DEV.apk\nE               com.fca.uconnect.sos_221109A_MELCO_DEV.apk\nE               com.fca.uconnect.tc_230711A_MELCO_DEV.apk\nE               com.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\nE               com.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\nE               drm.jar\nE               kim.files\n\ntests\\app_manager\\test_REF_18990.py:85: AssertionError","steps":[{"name":"Step 01: Remove drm.properties, backup files AND OLD LOGS","time":{"start":1767079341639,"stop":1767079341976,"duration":337},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Step 03: Remove drm.jar from /vendor/app_package","time":{"start":1767079341976,"stop":1767079342193,"duration":217},"status":"failed","statusMessage":"AssertionError: Failed to delete drm.jar\nassert 'drm.jar' not in 'com.fca.ada_221026A_MELCO_DEV.apk\\ncom.fca.uconnect.aota_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\\ncom.fca.uconnect.assist_230609A_MELCO_DEV.apk\\ncom.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\\ncom.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\\ncom.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\\ncom.fca.uconnect.iva_210217A_MELCO_DEV.apk\\ncom.fca.uconnect.ivm_230323F_MELCO_DEV.apk\\ncom.fca.uconnect.sos_221109A_MELCO_DEV.apk\\ncom.fca.uconnect.tc_230711A_MELCO_DEV.apk\\ncom.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\\ncom.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\\ndrm.jar\\nkim.files'\n  \n  'drm.jar' is contained here:\n    com.fca.ada_221026A_MELCO_DEV.apk\n    com.fca.uconnect.aota_220815B_MELCO_DEV.apk\n    com.fca.uconnect.aotaupdater_220815B_MELCO_DEV.apk\n    com.fca.uconnect.assist_230609A_MELCO_DEV.apk\n    com.fca.uconnect.batteryvehicle_230801A_MELCO_DEV_SR23.apk\n    com.fca.uconnect.connectedprofile_230613A_MELCO_DEV.apk\n    com.fca.uconnect.ecocoaching_230328A_MELCO_DEV.apk\n    com.fca.uconnect.iva_210217A_MELCO_DEV.apk\n    com.fca.uconnect.ivm_230323F_MELCO_DEV.apk\n    com.fca.uconnect.sos_221109A_MELCO_DEV.apk\n    com.fca.uconnect.tc_230711A_MELCO_DEV.apk\n    com.fca.uconnect.tutorials_230110A_MELCO_DEV.apk\n    com.fca.uconnect.wifihotspot_230621B_MELCO_DEV.apk\n    drm.jar\n    kim.files\n","statusTrace":"  File \"D:\\MD_Project\\Automation\\tests\\app_manager\\test_REF_18990.py\", line 85, in test_drm_recovery_retry_logic\n    assert JAR_NAME not in vendor_files, \"Failed to delete drm.jar\"\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":0,"stepsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":0,"stepsCount":2,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"maintain_drm_integrity::0","time":{"start":1767079342203,"stop":1767079380191,"duration":37988},"status":"passed","steps":[{"name":"Step 06 (Postcondition): Restore drm.jar and reboot HU","time":{"start":1767079342203,"stop":1767079380191,"duration":37988},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":1,"hasContent":true,"attachmentStep":false}],"labels":[{"name":"feature","value":"DRM Recovery"},{"name":"story","value":"Verify AppManager reads local backup files 3 times"},{"name":"parentSuite","value":"tests.app_manager"},{"name":"suite","value":"test_REF_18990"},{"name":"host","value":"DaveWSChen"},{"name":"thread","value":"24360-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.app_manager.test_REF_18990"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"d964bd7a474f2917.json","parameterValues":[]}