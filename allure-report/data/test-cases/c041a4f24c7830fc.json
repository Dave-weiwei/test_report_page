{"uid":"c041a4f24c7830fc","name":"test_01_02_echo_drm_value_to_empty","fullName":"tests.app_manager.test_REF_18992#test_01_02_echo_drm_value_to_empty","historyId":"c5c09174bcb49d21f061aa510cac0a83","time":{"start":1770791311244,"stop":1770791311244,"duration":0},"description":"Step 1, 2: 使指定檢查檔案的值為空","descriptionHtml":"<p>Step 1, 2: 使指定檢查檔案的值為空</p>\n","status":"broken","statusMessage":"RuntimeError: [Backup Error] CRITICAL ERROR: Remote file NOT FOUND: /data/data/com.fca.uconnectservice/files/drm.properties","statusTrace":"self = <module.file_manager.RemoteFileManager object at 0x00000136F0AAAFD0>\nremote_path = '/data/data/com.fca.uconnectservice/files/drm.properties', filenames = None\n\n    def backup_file(self, remote_path: str, filenames: Optional[Union[List[str], str]] = None):\n        \"\"\"\n        備份：\n        情境 1 (單一檔案): backup_file('/path/to/file.txt')\n        情境 2 (多個檔案): backup_file('/path/to/folder', ['a.txt', 'b.log'])\n        \"\"\"\n        try:\n            # 如果 filenames 是空的，代表 remote_path 本身就是完整的檔案路徑\n            if filenames is None:\n                print(f\">>> [Backup] Single file: {remote_path}\")\n    \n                ls_check = self.adb.shell(f\"ls {remote_path}\")\n                if \"No such file\" in ls_check or not ls_check.strip():\n>                   raise FileNotFoundError(f\"CRITICAL ERROR: Remote file NOT FOUND: {remote_path}\")\nE                   FileNotFoundError: CRITICAL ERROR: Remote file NOT FOUND: /data/data/com.fca.uconnectservice/files/drm.properties\n\nmodule\\file_manager.py:97: FileNotFoundError\n\nThe above exception was the direct cause of the following exception:\n\nadb = <module.adb_tool.ADBTool object at 0x00000136F02270E0>\n\n    @pytest.fixture(scope=\"module\", autouse=True)\n    def drm_file_manager(adb):\n        \"\"\"\n        使用 RemoteFileManager 管理 DRM 檔案\n        1. Setup: 備份遠端檔案到本地(backup/{ID}/...)\n        2. Test: 提供原始內容\n        3. Teardown: 測試結束後，強制寫回本地備份檔，確保環境乾淨\n        \"\"\"\n        manager = RemoteFileManager(adb, test_case_id=TEST_CASE_ID)\n        # 定義檔案路徑\n        remote_prop = f\"{TARGET_FILE}/{DRM_PROPERTIES}\"\n        remote_backup = f\"{TARGET_FILE}/{DRM_BACKUP}\"\n        local_prop = os.path.join(LOCAL_BACKUP_DIR, DRM_PROPERTIES)\n    \n        # 1. 執行備份\n>       if not manager.backup_file(remote_prop):\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests\\app_manager\\test_REF_18992.py:107: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <module.file_manager.RemoteFileManager object at 0x00000136F0AAAFD0>\nremote_path = '/data/data/com.fca.uconnectservice/files/drm.properties', filenames = None\n\n    def backup_file(self, remote_path: str, filenames: Optional[Union[List[str], str]] = None):\n        \"\"\"\n        備份：\n        情境 1 (單一檔案): backup_file('/path/to/file.txt')\n        情境 2 (多個檔案): backup_file('/path/to/folder', ['a.txt', 'b.log'])\n        \"\"\"\n        try:\n            # 如果 filenames 是空的，代表 remote_path 本身就是完整的檔案路徑\n            if filenames is None:\n                print(f\">>> [Backup] Single file: {remote_path}\")\n    \n                ls_check = self.adb.shell(f\"ls {remote_path}\")\n                if \"No such file\" in ls_check or not ls_check.strip():\n                    raise FileNotFoundError(f\"CRITICAL ERROR: Remote file NOT FOUND: {remote_path}\")\n    \n                return self._prepare_and_pull(remote_path)\n    \n            # 如果 filenames 是清單，代表要批次備份資料夾下的檔案\n            files = [filenames] if isinstance(filenames, str) else filenames\n            if not files: # 如果傳入的是空清單 []\n                raise ValueError(f\">>> [Warning] Backup aborted: 'filenames' is an empty list.\")\n            print(f\"\\n>>> [Backup] Batch: Folder {remote_path} with {len(files)} files\")\n    \n            results = {}\n            for f in files:\n                full_remote_path = posixpath.join(remote_path, f)\n                results[f] = self._prepare_and_pull(full_remote_path)\n    \n            is_all_success = all(results.values())\n            success_count = sum(results.values())\n            print(f\">>> [Finished] Backup {success_count}/{len(files)} successful. (Total: {is_all_success})\")\n            return is_all_success\n    \n        except Exception as e:\n            # 這裡捕獲所有錯誤並重新拋出，確保 Pytest 捕獲到並中止測試\n            error_msg = f\"[Backup Error] {str(e)}\"\n            print(f\"\\n{error_msg}\")\n>           raise RuntimeError(error_msg) from e\nE           RuntimeError: [Backup Error] CRITICAL ERROR: Remote file NOT FOUND: /data/data/com.fca.uconnectservice/files/drm.properties\n\nmodule\\file_manager.py:121: RuntimeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"adb","time":{"start":1770789482187,"stop":1770789482258,"duration":71},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"cantool_runtime_and_shutdown","time":{"start":1770789482187,"stop":1770789482187,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"drm_file_manager","time":{"start":1770791311246,"stop":1770791311357,"duration":111},"status":"broken","statusMessage":"RuntimeError: [Backup Error] CRITICAL ERROR: Remote file NOT FOUND: /data/data/com.fca.uconnectservice/files/drm.properties\n","statusTrace":"  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n          ^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n            ^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\fixtures.py\", line 1196, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\fixtures.py\", line 923, in call_fixture_func\n    fixture_result = next(generator)\n  File \"D:\\MD_Project\\Automation\\tests\\app_manager\\test_REF_18992.py\", line 107, in drm_file_manager\n    if not manager.backup_file(remote_prop):\n           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^\n  File \"D:\\MD_Project\\Automation\\module\\file_manager.py\", line 121, in backup_file\n    raise RuntimeError(error_msg) from e\n","steps":[],"attachments":[],"parameters":[],"hasContent":true,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":true}],"afterStages":[{"name":"cantool_runtime_and_shutdown::0","time":{"start":1770794423070,"stop":1770794423071,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false}],"labels":[{"name":"parentSuite","value":"tests.app_manager"},{"name":"suite","value":"test_REF_18992"},{"name":"host","value":"DaveWSChen"},{"name":"thread","value":"5600-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.app_manager.test_REF_18992"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":[]},"source":"c041a4f24c7830fc.json","parameterValues":[]}