{"uid":"4b975136bdb78232","name":"test_01_capture_baseline","fullName":"tests.app_manager.test_REF_18989#test_01_capture_baseline","historyId":"7ea39ab05cd9d8be1b3d0aed47455f21","time":{"start":1770791119128,"stop":1770791119128,"duration":0},"description":"Step 1: 確認環境已重置 (Hash 應為空，Prop 應為 Dummy) ","descriptionHtml":"<p>Step 1: 確認環境已重置 (Hash 應為空，Prop 應為 Dummy)</p>\n","status":"broken","statusMessage":"RuntimeError: Process still alive after force-stop","statusTrace":"adb = <module.adb_tool.ADBTool object at 0x00000136F02270E0>\n\n    @pytest.fixture(scope=\"module\", autouse=True)\n    def setup_env(adb):\n        print(f\"\\n>>> [Setup] Starting Environment Reset for Case {TEST_CASE_ID}...\")\n        adb.root()\n        time.sleep(1)\n    \n        # --- A. 執行備份 (Backup) ---\n        # 直接在這裡初始化 Manager 並備份，邏輯不分家\n        try:\n            rfm = RemoteFileManager(adb, test_case_id=TEST_CASE_ID, clean_before_backup=True)\n            print(\">>> [Setup] Backing up existing files...\")\n            rfm.backup_file(DRM_PROP_FILE)\n            rfm.backup_file(DRM_BACKUP_FILE)\n            rfm.backup_file(DRM_XML_FILE)\n        except Exception as e:\n            print(f\">>> [Setup Warning] Backup restore_file (Non-fatal): {e}\")\n    \n        # --- B. 強制停止 App (Force Stop) ---\n        print(f\">>> [Setup] Force stopping {TARGET_PACKAGE}...\")\n        adb.shell(f\"am force-stop {TARGET_PACKAGE}\")\n        # --- D. 重置 Prop 和 Backup 為空 ---\n        print(\">>> [Setup] Resetting Properties and Backup with DUMMY data...\")\n        dummy_content = \"\"\n    \n        adb.shell(f\"echo '{dummy_content}' > {DRM_PROP_FILE}\")\n        adb.shell(f\"chmod 600 {DRM_PROP_FILE}\")\n    \n        adb.shell(f\"echo '{dummy_content}' > {DRM_BACKUP_FILE}\")\n        adb.shell(f\"chmod 600 {DRM_BACKUP_FILE}\")\n    \n        # --- E. 啟動測試 App (Launch) ---\n        print(\">>> [Setup] Relaunching Test App...\")\n>       adb.active_test_app()\n\ntests\\app_manager\\test_REF_18989.py:232: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmodule\\adb_tool.py:193: in active_test_app\n    self._ensure_app_process_killed(package)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <module.adb_tool.ADBTool object at 0x00000136F02270E0>, package = 'com.fca.appmanagertestapp', timeout = 3.0\n\n    def _ensure_app_process_killed(self, package, timeout=3.0):\n        self.shell(f\"am force-stop {package}\")\n    \n        start = time.time()\n        while time.time() - start < timeout:\n            if not self._get_pids(package):\n                return\n            time.sleep(0.2)\n    \n>       raise RuntimeError(\"Process still alive after force-stop\")\nE       RuntimeError: Process still alive after force-stop\n\nmodule\\adb_tool.py:241: RuntimeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"adb","time":{"start":1770789482187,"stop":1770789482258,"duration":71},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"cantool_runtime_and_shutdown","time":{"start":1770789482187,"stop":1770789482187,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"setup_env","time":{"start":1770791119129,"stop":1770791126070,"duration":6941},"status":"broken","statusMessage":"RuntimeError: Process still alive after force-stop\n","statusTrace":"  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n          ^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n            ^^^^^\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\pluggy\\_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\fixtures.py\", line 1196, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n  File \"C:\\Users\\DaveWSChen\\AppData\\Local\\Programs\\Python\\Python314\\Lib\\site-packages\\_pytest\\fixtures.py\", line 923, in call_fixture_func\n    fixture_result = next(generator)\n  File \"D:\\MD_Project\\Automation\\tests\\app_manager\\test_REF_18989.py\", line 232, in setup_env\n    adb.active_test_app()\n    ~~~~~~~~~~~~~~~~~~~^^\n  File \"D:\\MD_Project\\Automation\\module\\adb_tool.py\", line 193, in active_test_app\n    self._ensure_app_process_killed(package)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^\n  File \"D:\\MD_Project\\Automation\\module\\adb_tool.py\", line 241, in _ensure_app_process_killed\n    raise RuntimeError(\"Process still alive after force-stop\")\n","steps":[],"attachments":[],"parameters":[],"hasContent":true,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":true}],"afterStages":[{"name":"cantool_runtime_and_shutdown::0","time":{"start":1770794423070,"stop":1770794423071,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"attachmentStep":false,"attachmentsCount":0,"shouldDisplayMessage":false}],"labels":[{"name":"parentSuite","value":"tests.app_manager"},{"name":"suite","value":"test_REF_18989"},{"name":"host","value":"DaveWSChen"},{"name":"thread","value":"5600-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.app_manager.test_REF_18989"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":[]},"source":"4b975136bdb78232.json","parameterValues":[]}